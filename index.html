<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Chat Manager</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; }
        #sidebar { width: 30%; background: #f3f3f3; padding: 20px; }
        #chat-window { width: 70%; padding: 20px; }
        .user { padding: 10px; cursor: pointer; border-bottom: 1px solid #ccc; }
        .user:hover { background: #ddd; }
        #messages { border: 1px solid #ccc; height: 400px; overflow-y: auto; padding: 10px; }
        .sent { text-align: right; color: blue; }
        .received { text-align: left; color: green; }
        #message-input { width: 80%; padding: 10px; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h3>Chats</h3>
        <div id="users"></div>
    </div>

    <div id="chat-window">
        <h3 id="chat-title">Select a user</h3>
        <div id="messages"></div>
        <input type="text" id="message-input" placeholder="Type a message...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        let selectedPhone = "";

        function loadUsers() {
            fetch("/chats").then(res => res.json()).then(users => {
                let userList = "";
                users.forEach(phone => {
                    userList += `<div class="user" onclick="openChat('${phone}')">${phone}</div>`;
                });
                document.getElementById("users").innerHTML = userList;
            });
        }

        function openChat(phone) {
            selectedPhone = phone;
            document.getElementById("chat-title").innerText = `Chat with ${phone}`;
            fetch(`/messages/${phone}`).then(res => res.json()).then(messages => {
                let messageList = "";
                messages.forEach(msg => {
                    let className = msg.direction === "sent" ? "sent" : "received";
                    messageList += `<div class="${className}">${msg.text || "Media File"}</div>`;
                });
                document.getElementById("messages").innerHTML = messageList;
            });
        }

        function sendMessage() {
            let message = document.getElementById("message-input").value;
            if (!selectedPhone || !message) return alert("Select a user and type a message!");

            fetch("/send", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ phone: selectedPhone, message })
            }).then(res => res.json()).then(data => {
                if (data.success) {
                    openChat(selectedPhone);
                    document.getElementById("message-input").value = "";
                } else {
                    alert("Error sending message");
                }
            });
        }

        loadUsers();
    </script>

</body>
</html>
